<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>?</title>
<style>
  :root{
    --bg: #000;
    --accent: #fff;
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    font-family:system-ui,Segoe UI,Roboto;
    overflow:hidden;
  }

  .center {
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .btn {
    background:var(--accent);
    color:#000;
    padding:14px 22px;
    border-radius:10px;
    border:0;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 4px 0 rgba(0,0,0,0.35);
    font-size:1.1rem;
    transition:transform .2s ease;
  }
  .btn:hover{
    transform:scale(1.05);
  }

  .overlay {
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#000;
    opacity:0;
    pointer-events:none;
    transition:opacity 0.8s ease;
  }
  .overlay.show {
    opacity:1;
    pointer-events:auto;
  }

  .anim {
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    image-rendering:pixelated;
    opacity:0;
    transform:scale(1.1);
    transition:opacity 1.2s ease, transform 4s ease;
  }
  .anim.visible{
    opacity:1;
    transform:scale(1);
  }

  /* monk.png ajustado para caber na tela */
  .anim.monk {
    object-fit: contain;
    width: 100%;
    height: 100%;
    background-color: #000;
  }

  .countdown {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 10vw;
    color: rgba(255, 255, 255, 0.5);
    font-weight: bold;
    z-index: 15;
    opacity: 0;
    transition: opacity 1s ease-in-out;
    animation: pulse 1s infinite;
  }

  @keyframes pulse {
    50% { transform: translate(-50%, -50%) scale(1.05); }
  }

  .close {
    position:fixed;
    top:16px;
    right:16px;
    background:rgba(0,0,0,0.3);
    color:#fff;
    border:0;
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:1.2rem;
    z-index:10;
    transition:background .3s ease;
  }
  .close:hover {
    background:rgba(255,255,255,0.25);
  }
</style>
</head>
<body>
  <div class="center">
    <button id="playBtn" class="btn">Confia no pai</button>
  </div>

  <div id="overlay" class="overlay">
    <img id="anim" class="anim" alt="Animação" data-src="anim.gif" />
    <div id="countdown" class="countdown"></div>
    <button id="close" class="close">✕</button>
  </div>

  <audio id="audio" preload="auto" src="music.mp3" loop></audio>

<script>
  const btn = document.getElementById('playBtn');
  const overlay = document.getElementById('overlay');
  const anim = document.getElementById('anim');
  const audio = document.getElementById('audio');
  const closeBtn = document.getElementById('close');
  const countdownEl = document.getElementById('countdown');

  let audioContext, analyser, source;
  let countdownInterval;

  function startCountdown() {
    let timeLeft = 20;
    countdownEl.style.opacity = 1;
    countdownEl.textContent = timeLeft;

    countdownInterval = setInterval(() => {
      timeLeft--;
      countdownEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(countdownInterval);
        countdownEl.style.display = 'none';
        // Troca o GIF por monk.png e ajusta o estilo
        anim.src = "monk.png";
        anim.classList.add("monk");
      }
    }, 1000);
  }

  async function openExperience() {
    // muda o nome da aba
    document.title = "Surpresa!";

    overlay.classList.add('show');

    const gifUrl = anim.getAttribute('data-src');
    if (!anim.src) {
      const img = new Image();
      img.src = gifUrl;
      img.onload = () => {
        anim.src = gifUrl;
        requestAnimationFrame(()=> anim.classList.add('visible'));
      };
    } else {
      anim.classList.add('visible');
    }

    try {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        source = audioContext.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioContext.destination);
      }

      if (audioContext.state === 'suspended') {
        await audioContext.resume();
      }

      audio.currentTime = 0;
      await audio.play();

      startCountdown();

    } catch (err) {
      console.warn('Erro ao iniciar áudio:', err);
    }
  }

  function closeExperience() {
    anim.classList.remove('visible', 'monk');
    overlay.classList.remove('show');
    countdownEl.style.opacity = 0;
    countdownEl.style.display = 'block';

    document.title = "?"; // restaura o nome original

    audio.pause();
    audio.currentTime = 0;

    clearInterval(countdownInterval);
  }

  btn.addEventListener('click', openExperience);
  closeBtn.addEventListener('click', closeExperience);

  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape' && overlay.classList.contains('show')) closeExperience();
  });
</script>
</body>
</html>
